import{w as J,_ as W,a_ as G,a$ as K,ac as X,$ as Z,a3 as H,x as g,ax as Q,aF as I,aI as z,ad as U,b0 as L,a9 as Y,aa as tt}from"./05T4oqLv.js";import{B as et}from"./DR3uVYO0.js";import{m as nt,i as rt,a as C,b as st,e as ot,M as w,t as ct,d as ut,g as D,I as M,h as at,j as it}from"./D4oXasEG.js";function Ct(t,r,...e){var o=new et(t);J(()=>{const i=r()??null;o.ensure(i,i&&(c=>i(c,...e)))},W)}function Et(t){const r=Symbol();return{key:r,consume(){return K(r)||t},provide(e){return G(r,e)}}}function ft(t){return new Proxy({},{get(r,e){return e==="style"?o=>t({style:o}).style:t}})}var wt=()=>t=>Array.from(new Set(t));const q={className:"class",defaultChecked:"checked",defaultValue:"value",htmlFor:"for",onBlur:"onfocusout",onChange:"oninput",onFocus:"onfocusin",onDoubleClick:"ondblclick"};function O(t){let r="";for(let e in t){const o=t[e];o!=null&&(e.startsWith("--")||(e=e.replace(/[A-Z]/g,i=>`-${i.toLowerCase()}`)),r+=`${e}:${o};`)}return r}const lt=new Set("viewBox,className,preserveAspectRatio,fillRule,clipPath,clipRule,strokeWidth,strokeLinecap,strokeLinejoin,strokeDasharray,strokeDashoffset,strokeMiterlimit".split(","));function gt(t){return t in q?q[t]:lt.has(t)?t:t.toLowerCase()}function dt(t,r){return t==="style"&&typeof r=="object"?O(r):r}const Nt=ft(t=>{const r={};for(const e in t)r[gt(e)]=dt(e,t[e]);return r}),pt=/((?:--)?(?:\w+-?)+)\s*:\s*([^;]*)/g,mt=t=>{const r={};let e;for(;e=pt.exec(t);)r[e[1]]=e[2];return r};function Rt(...t){const r=[];for(const o of t)o&&"class"in o&&o.class!=null&&r.push(o.class);const e=nt(...t);return r.length>0&&(e.class=r.length===1?r[0]:r),"style"in e&&(typeof e.style=="string"&&(e.style=mt(e.style)),e.style=O(e.style)),e}function $(t){const r=t().defaultValue??t().value,e=t().isEqual??Object.is;let o=X(Z(r));const i=z(()=>t().value!==void 0);let c={current:H(()=>g(o))},p={current:void 0};Q(()=>{const a=g(i)?t().value:g(o);c={current:a},p={current:a}});const b=a=>{const d=C(a)?a(c.current):a,y=p.current;t().debug&&console.log(`[bindable > ${t().debug}] setValue`,{next:d,prev:y}),g(i)||U(o,d,!0),e(d,y)||t().onChange?.(d,y)};function m(){return g(i)?t().value:g(o)}return{initial:r,ref:c,get:m,set(a){(t().sync?I:rt)(()=>b(a))},invoke(a,d){t().onChange?.(a,d)},hash(a){return t().hash?.(a)??String(a)}}}$.cleanup=t=>{L(()=>t())};$.ref=t=>{let r=t;return{get:()=>r,set:e=>{r=e}}};function yt(t){const r={current:t};return{get(e){return r.current[e]},set(e,o){r.current[e]=o}}}const _=t=>typeof t=="function"?t():t,ht=(t,r)=>{let e=[],o=!0;Y(()=>{if(o){e=t.map(c=>_(c)),o=!1;return}let i=!1;for(let c=0;c<t.length;c++)if(!st(e[c],_(t[c]))){i=!0;break}i&&(e=t.map(c=>_(c)),r())})};function j(t){return C(t)?t():t}function kt(t,r){const e=z(()=>{const{id:n,ids:s,getRootNode:f}=j(r);return at({id:n,ids:s,getRootNode:f})}),o=(...n)=>{t.debug&&console.log(...n)},i=z(()=>t.props?.({props:it(j(r)),scope:g(e)})??j(r)),c=xt(()=>g(i)),p=t.context?.({prop:c,bindable:$,get scope(){return g(e)},flush:B,getContext(){return b},getComputed(){return k},getRefs(){return R},getEvent(){return N()}}),b={get(n){return p?.[n].get()},set(n,s){p?.[n].set(s)},initial(n){return p?.[n].initial},hash(n){const s=p?.[n].get();return p?.[n].hash(s)}};let m=new Map,a={current:null},d={current:null},y={current:{type:""}};const N=()=>({...y.current,current(){return y.current},previous(){return d.current}}),F=()=>({...x,hasTag(n){const s=x.get();return!!t.states[s]?.tags?.includes(n)},matches(...n){const s=x.get();return n.includes(s)}}),R=yt(t.refs?.({prop:c,context:b})??{}),h=()=>({state:F(),context:b,event:N(),prop:c,send:V,action:v,guard:A,track:ht,refs:R,computed:k,flush:B,scope:g(e),choose:T}),v=n=>{const s=C(n)?n(h()):n;if(!s)return;const f=s.map(u=>{const l=t.implementations?.actions?.[u];return l||D(`[zag-js] No implementation found for action "${JSON.stringify(u)}"`),l});for(const u of f)u?.(h())},A=n=>C(n)?n(h()):t.implementations?.guards?.[n](h()),P=n=>{const s=C(n)?n(h()):n;if(!s)return;const f=s.map(l=>{const S=t.implementations?.effects?.[l];return S||D(`[zag-js] No implementation found for effect "${JSON.stringify(l)}"`),S}),u=[];for(const l of f){const S=l?.(h());S&&u.push(S)}return()=>u.forEach(l=>l?.())},T=n=>ct(n).find(s=>{let f=!s.guard;return ut(s.guard)?f=!!A(s.guard):C(s.guard)&&(f=s.guard(h())),f}),k=n=>{ot(t.computed,()=>"[zag-js] No computed object found on machine");const s=t.computed[n];return s({context:b,event:N(),prop:c,refs:R,scope:g(e),computed:k})},x=$(()=>({defaultValue:t.initialState({prop:c}),onChange(n,s){s&&(m.get(s)?.(),m.delete(s)),s&&v(t.states[s]?.exit),v(a.current?.actions);const f=P(t.states[n]?.effects);if(f&&m.set(n,f),s===M){v(t.entry);const u=P(t.effects);u&&m.set(M,u)}v(t.states[n]?.entry)}}));let E=w.NotStarted;tt(()=>{const n=E===w.Started;E=w.Started,o(n?"rehydrating...":"initializing..."),x.invoke(x.initial,M)}),L(()=>{o("unmounting..."),E=w.Stopped,m.forEach(n=>n?.()),m=new Map,a.current=null,v(t.exit)});const V=n=>{if(E!==w.Started)return;d.current=y.current,y.current=n;let s=x.get();const f=t.states[s].on?.[n.type]??t.on?.[n.type],u=T(f);if(!u)return;a.current=u;const l=u.target??s;o("transition",n.type,u.target||s,`(${u.actions})`);const S=l!==s;S?x.set(l):u.reenter&&!S?x.invoke(s,s):v(u.actions)};return t.watch?.(h()),{get state(){return F()},send:V,context:b,prop:c,get scope(){return g(e)},refs:R,computed:k,get event(){return N()},getStatus:()=>E}}function xt(t){return function(e){return t()[e]}}function B(t){I(()=>{queueMicrotask(()=>t())})}export{wt as a,Et as c,Rt as m,Nt as n,Ct as s,kt as u};
